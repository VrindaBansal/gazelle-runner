<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gazelle Runner - Gaze Controlled Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #F7F7F7;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        #gameContainer {
            position: relative;
            border: 2px solid #535353;
            border-radius: 4px;
            background: #F7F7F7;
        }

        #gameCanvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #2F4F4F;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 0px #FFFFFF;
        }

        #controls {
            margin-top: 20px;
            text-align: center;
            color: #2F4F4F;
        }

        #startButton, #calibrateButton {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            margin: 5px;
            border-radius: 5px;
        }

        #startButton:hover, #calibrateButton:hover {
            background: #A0522D;
        }

        #video {
            position: absolute;
            top: -1000px;
            left: -1000px;
            width: 320px;
            height: 240px;
        }

        #videoPreview {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 240px;
            height: 180px;
            border: 3px solid #8B4513;
            border-radius: 8px;
            background: #000;
            display: none;
            z-index: 100;
        }

        #videoPreview video {
            width: 100%;
            height: 100%;
            border-radius: 5px;
            transform: scaleX(-1); /* Mirror the video */
        }

        #videoPreview.active {
            display: block;
        }

        #gazeIndicator {
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            height: 25px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }

        #gazeIndicator.up {
            background: rgba(0, 255, 0, 0.9);
            color: black;
        }

        #gazeIndicator.down {
            background: rgba(255, 165, 0, 0.9);
            color: black;
        }

        #gazeIndicator.left {
            background: rgba(0, 150, 255, 0.9);
            color: white;
        }

        #gazeIndicator.right {
            background: rgba(255, 0, 150, 0.9);
            color: white;
        }

        #debugInfo {
            position: absolute;
            bottom: 30px;
            left: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 5px;
            border-radius: 5px;
            font-family: monospace;
            line-height: 1.2;
        }

        #togglePreview {
            position: absolute;
            bottom: 200px;
            right: 10px;
            background: #8B4513;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            border-radius: 5px;
            z-index: 101;
            display: none;
        }

        #stopTracking {
            position: absolute;
            bottom: 170px;
            right: 10px;
            background: #CC3333;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            border-radius: 5px;
            z-index: 101;
            display: none;
        }

        #stopTracking:hover {
            background: #DD4444;
        }

        #togglePreview:hover {
            background: #A0522D;
        }

        #togglePreview.active {
            display: block;
        }

        #gazeStatus {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="ui">
            <div>Score: <span id="score">0</span></div>
            <div>High Score: <span id="highScore">0</span></div>
        </div>
        <div id="gazeStatus">Head: Neutral</div>
    </div>

    <div id="controls">
        <button id="startButton">Start Game</button>
        <button id="calibrateButton">Enable Head Tracking</button>
        <div style="margin-top: 10px; font-size: 14px;">
            <p><strong>Head Controls:</strong> Tilt UP to jump, Nod DOWN to duck</p>
            <p><strong>Obstacles:</strong> Jump over rocks, duck under bars</p>
            <p>Keyboard backup: Spacebar (jump), Down arrow (duck)</p>
        </div>
    </div>

    <video id="video" autoplay muted playsinline></video>

    <div id="videoPreview">
        <video id="previewVideo" autoplay muted playsinline></video>
        <div id="gazeIndicator">NEUTRAL</div>
        <div id="debugInfo">
            X: 0.000<br>
            Y: 0.000<br>
            History: []
        </div>
    </div>

    <button id="togglePreview">Hide Preview</button>
    <button id="stopTracking">Stop Tracking</button>

    <!-- MediaPipe for reliable face detection -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>

    <script src="simple_head_tracker.js"></script>
    <script src="game.js"></script>
</body>
</html>